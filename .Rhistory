logRankData
logRankData <- times %>%
ungroup() %>%
mutate(d01 = ifelse(Type == 1, 1, 0),
d02 = ifelse(Type == 2, 1, 0)) %>%
mutate(yDot = cumsum(d0 %>% rev()) %>% rev())
logRankData
times <- rbind(t1, t2) %>%
data.frame() %>%
setNames(c("Time", "Type")) %>%
group_by(Type) %>%
arrange(Time) %>%
mutate(d = 1,
y = cumsum(d %>% rev()) %>% rev(),
nelAal = cumsum(d0/y))
times$Type = as.factor(times$Type)
times %>%
ggplot(aes(x = Time, y = nelAal, color = Type)) +
geom_line(size = 1.25)
times %>%
ggplot(aes(x = Time, y = nelAal, color = Type)) +
geom_line(size = 1)
times %>%
ggplot(aes(x = Time, y = nelAal, color = Type)) +
geom_line(size = 0.8)
logRankData <- times %>%
ungroup() %>%
mutate(d1 = ifelse(Type == 1, 1, 0),
d2 = ifelse(Type == 2, 1, 0),
yBoth = cumsum(d0 %>% rev()) %>% rev(),
y1 = cumsum(d1 %>% rev()) %>% rev(),
Z1 = cumsum(d01) - cumsum(y1*d/yBoth))
logRankData <- times %>%
ungroup() %>%
mutate(d1 = ifelse(Type == 1, 1, 0),
d2 = ifelse(Type == 2, 1, 0),
yBoth = cumsum(d0 %>% rev()) %>% rev(),
y1 = cumsum(d1 %>% rev()) %>% rev(),
Z1 = cumsum(d1) - cumsum(y1*d/yBoth))
times <- rbind(t1, t2) %>%
data.frame() %>%
setNames(c("Time", "Type")) %>%
group_by(Type) %>%
arrange(Time) %>%
mutate(d = 1,
y = cumsum(d %>% rev()) %>% rev(),
nelAal = cumsum(d/y))
times$Type = as.factor(times$Type)
times %>%
ggplot(aes(x = Time, y = nelAal, color = Type)) +
geom_line(size = 0.8)
logRankData <- times %>%
ungroup() %>%
mutate(d1 = ifelse(Type == 1, 1, 0),
d2 = ifelse(Type == 2, 1, 0),
yBoth = cumsum(d %>% rev()) %>% rev(),
y1 = cumsum(d1 %>% rev()) %>% rev(),
Z1 = cumsum(d1) - cumsum(y1*d/yBoth))
logRankData
logRankData <- times %>%
ungroup() %>%
mutate(d1 = ifelse(Type == 1, 1, 0),
d2 = ifelse(Type == 2, 1, 0),
yBoth = cumsum(d %>% rev()) %>% rev(),
y1 = cumsum(d1 %>% rev()) %>% rev(),
Z1 = cumsum(d1) - cumsum(y1*d/yBoth),
varZ1 = y1*y1*d/yBoth^2)
logRankData <- times %>%
ungroup() %>%
mutate(d1 = ifelse(Type == 1, 1, 0),
d2 = ifelse(Type == 2, 1, 0),
yBoth = cumsum(d %>% rev()) %>% rev(),
y1 = cumsum(d1 %>% rev()) %>% rev(),
Z1 = cumsum(d1) - cumsum(y1*d/yBoth),
varZ1 = y1*y1*d/yBoth^2,
testStat = Z1/sqrt(varZ1))
logRankData
logRankData$testStat
logRankData$varZ1
logRankData$yBoth
logRankData$y1
logRankData$y2
logRankData$y
times
times %>%
ungroup() %>%
mutate(d1 = ifelse(Type == 1, 1, 0),
d2 = ifelse(Type == 2, 1, 0))
a <- times %>%
ungroup() %>%
mutate(d1 = ifelse(Type == 1, 1, 0),
d2 = ifelse(Type == 2, 1, 0))
cumsum(a$d1 %>% rev()) %>% rev()
logRankData <- times %>%
ungroup() %>%
mutate(d1 = ifelse(Type == 1, 1, 0),
d2 = ifelse(Type == 2, 1, 0),
yBoth = cumsum(d %>% rev()) %>% rev(),
y1 = cumsum(d1 %>% rev()) %>% rev(),
Z1 = cumsum(d1) - cumsum(y1*d/yBoth),
varZ1 = y1*y1*d/yBoth^2,
testStat = Z1/sqrt(varZ1))
logRankData$testStat
logRankData <- times %>%
ungroup() %>%
mutate(d1 = ifelse(Type == 1, 1, 0),
d2 = ifelse(Type == 2, 1, 0),
yBoth = cumsum(d %>% rev()) %>% rev(),
y1 = cumsum(d1 %>% rev()) %>% rev(),
Z1 = cumsum(d1) - cumsum(y1*d/yBoth),
varZ1 = y1*y2*d/yBoth^2,
testStat = Z1/sqrt(varZ1))
logRankData <- times %>%
ungroup() %>%
mutate(d1 = ifelse(Type == 1, 1, 0),
d2 = ifelse(Type == 2, 1, 0),
yBoth = cumsum(d %>% rev()) %>% rev(),
y1 = cumsum(d1 %>% rev()) %>% rev(),
y2 = cumsum(d2 %>% rev()) %>% rev(),
Z1 = cumsum(d1) - cumsum(y1*d/yBoth),
varZ1 = y1*y2*d/yBoth^2,
testStat = Z1/sqrt(varZ1))
logRankTest
logRankData <- times %>%
ungroup() %>%
mutate(d1 = ifelse(Type == 1, 1, 0),
d2 = ifelse(Type == 2, 1, 0),
yBoth = cumsum(d %>% rev()) %>% rev(),
y1 = cumsum(d1 %>% rev()) %>% rev(),
y2 = cumsum(d2 %>% rev()) %>% rev(),
Z1 = cumsum(d1) - cumsum(y1*d/yBoth),
varZ1 = y1*y2*d/yBoth^2,
testStat = Z1/sqrt(varZ1))
logRankData$testStat
times
kmData %>% times %>%
mutate(KM = cumprod(1 - d/y))
kmData <- times %>%
mutate(KM = cumprod(1 - d/y))
kmData
times <- rbind(t1, t2) %>%
data.frame() %>%
setNames(c("Time", "Type")) %>%
group_by(Type) %>%
arrange(Time) %>%
mutate(d = 1,
y = cumsum(d %>% rev()) %>% rev(),
nelAal = cumsum(d/y),
km = cumprod(1 - d/y))
times %>%
ggplot(aes(x = Time, y = KM, color = Type)) +
geom_line(size = 0.8)
times %>%
ggplot(aes(x = Time, y = km, color = Type)) +
geom_line(size = 0.8)
times$Type = as.factor(times$Type)
times %>%
ggplot(aes(x = Time, y = nelAal, color = Type)) +
geom_line(size = 0.8)
times %>%
ggplot(aes(x = Time, y = km, color = Type)) +
geom_line(size = 0.8)
t1 <- cbind(rweibull(200, shape = 5.5, scale = 22.5), rep(1, 200))
t2 <- cbind(rweibull(100, shape = 4.5, scale = 28), rep(2,100))
times <- rbind(t1, t2) %>%
data.frame() %>%
setNames(c("Time", "Type")) %>%
group_by(Type) %>%
arrange(Time) %>%
mutate(d = 1,
y = cumsum(d %>% rev()) %>% rev(),
nelAal = cumsum(d/y),
km = cumprod(1 - d/y))
# Chunk 1
suppressPackageStartupMessages(library(tidyverse))
suppressPackageStartupMessages(library(knitr))
suppressPackageStartupMessages(library(fitdistrplus))
# Chunk 2
t1 <- cbind(rweibull(200, shape = 5.5, scale = 22.5), rep(1, 200))
t2 <- cbind(rweibull(100, shape = 4.5, scale = 28), rep(2,100))
times <- rbind(t1, t2) %>%
data.frame() %>%
setNames(c("Time", "Type")) %>%
group_by(Type) %>%
arrange(Time) %>%
mutate(d = 1,
y = cumsum(d %>% rev()) %>% rev(),
nelAal = cumsum(d/y),
km = cumprod(1 - d/y))
times$Type = as.factor(times$Type)
#Different Nelson-Aalens
times %>%
ggplot(aes(x = Time, y = nelAal, color = Type)) +
geom_line(size = 0.8)
#Logrank. Oklart om detta är rätt?
logRankData <- times %>%
ungroup() %>%
mutate(d1 = ifelse(Type == 1, 1, 0),
d2 = ifelse(Type == 2, 1, 0),
yBoth = cumsum(d %>% rev()) %>% rev(),
y1 = cumsum(d1 %>% rev()) %>% rev(),
y2 = cumsum(d2 %>% rev()) %>% rev(),
Z1 = cumsum(d1) - cumsum(y1*d/yBoth),
varZ1 = y1*y2*d/yBoth^2,
testStat = Z1/sqrt(varZ1))
#Kaplan-Meier
times %>%
ggplot(aes(x = Time, y = km, color = Type)) +
geom_line(size = 0.8)
times <- rbind(t1, t2) %>%
data.frame() %>%
setNames(c("Time", "Type")) %>%
group_by(Type) %>%
arrange(Time) %>%
mutate(d = 1,
y = cumsum(d %>% rev()) %>% rev(),
nelAal = cumsum(d/y),
km = cumprod(1 - d/y))
times$Type = as.factor(times$Type)
times %>%
ggplot(aes(x = Time, y = nelAal, color = Type)) +
geom_line(size = 0.8)
logRankData <- times %>%
ungroup() %>%
mutate(d1 = ifelse(Type == 1, 1, 0),
d2 = ifelse(Type == 2, 1, 0),
yBoth = cumsum(d %>% rev()) %>% rev(),
y1 = cumsum(d1 %>% rev()) %>% rev(),
y2 = cumsum(d2 %>% rev()) %>% rev(),
Z1 = cumsum(d1) - cumsum(y1*d/yBoth),
varZ1 = y1*y2*d/yBoth^2,
testStat = Z1/sqrt(varZ1))
logRankData
logRankData$testStat
logRankData <- times %>%
ungroup() %>%
mutate(d1 = ifelse(Type == 1, 1, 0),
d2 = ifelse(Type == 2, 1, 0),
yBoth = cumsum(d %>% rev()) %>% rev(),
y1 = cumsum(d1 %>% rev()) %>% rev(),
y2 = cumsum(d2 %>% rev()) %>% rev(),
Z1 = cumsum(d1) - cumsum(y1*d/yBoth),
varZ1 = y1*y2*d/yBoth^2,
testStat = Z1/sqrt(varZ1))
logRankData
times
cbind(runif(300, 20, 60))
c <- cbind(runif(300, 20, 60))
rbind(t1, t2) %>%
cbind(c) %>%
data.frame() %>%
setNames(c("Time", "Type", "C"))
rbind(t1, t2) %>%
cbind(c) %>%
data.frame() %>%
setNames(c("Time", "Type", "C")) %>%
mutate(Time = ifelse(Time > C, C, Time))
rbind(t1, t2) %>%
cbind(c) %>%
data.frame() %>%
setNames(c("Time", "Type", "C")) %>%
mutate(cens = ifelse(Time > C, 1, 0),
Time = ifelse(Time > C, C, Time))
times <- rbind(t1, t2) %>%
cbind(c) %>%
data.frame() %>%
setNames(c("Time", "Type", "C")) %>%
mutate(c = ifelse(Time > C, 1, 0),
Time = ifelse(Time > C, C, Time),
d = 1 - c,
e = c + d) %>%
group_by(Type) %>%
arrange(Time) %>%
mutate(y = cumsum(e %>% rev()) %>% rev(),
nelAal = cumsum(d/y),
km = cumprod(1 - d/y))
times$Type = as.factor(times$Type)
times %>%
ggplot(aes(x = Time, y = nelAal, color = Type)) +
geom_line(size = 0.8)
times
times %>% filter(c == 1)
times <- rbind(t1, t2) %>%
cbind(c) %>%
data.frame() %>%
setNames(c("Time", "Type", "C")) %>%
mutate(c = ifelse(Time > C, 1, 0),
Time = ifelse(Time > C, C, Time),
d = 1 - c,
e = c + d) %>%
group_by(Type) %>%
arrange(Time) %>%
mutate(y = cumsum(e %>% rev()) %>% rev(),
nelAal = cumsum(d/y),
km = cumprod(1 - d/y))
times$Type = as.factor(times$Type)
times %>%
ggplot(aes(x = Time, y = nelAal, color = Type)) +
geom_line(size = 0.8)
times
logRankData <- times %>%
ungroup() %>%
mutate(d1 = ifelse(Type == 1, d, 0),
d2 = ifelse(Type == 2, d, 0),
c1 = ifelse(Type == 1, c, 0),
c2 = ifelse(Type == 2, c, 0),
e1 = d1 + c1,
e2 = d2 + c2,
yBoth = cumsum(e %>% rev()) %>% rev(),
y1 = cumsum(e1 %>% rev()) %>% rev(),
y2 = cumsum(e2 %>% rev()) %>% rev(),
Z1 = cumsum(d1) - cumsum(y1*d/yBoth),
varZ1 = y1*y2*d/yBoth^2,
testStat = Z1/sqrt(varZ1))
logRankData
logRankData$testStat
times %>%
ggplot(aes(x = Time, y = km, color = Type)) +
geom_line(size = 0.8)
logRankData %>%
ggplot(aes(x = Time, y = testStat, color = Type)) +
geom_line(size = 0.8)
logRankData$Type =  as.factor(logRankData$Type)
logRankData %>%
ggplot(aes(x = Time, y = testStat, color = Type)) +
geom_line(size = 0.8)
logRankData$Type =  as.factor(logRankData$Type)
logRankData %>%
ggplot(aes(x = Time, y = testStat, color = Type)) +
geom_line(size = 0.8)
logRankData <- times %>%
ungroup() %>%
mutate(d1 = ifelse(Type == 1, d, 0),
d2 = ifelse(Type == 2, d, 0),
c1 = ifelse(Type == 1, c, 0),
c2 = ifelse(Type == 2, c, 0),
e1 = d1 + c1,
e2 = d2 + c2) %>%
group_by(Type) %>%
arrange(Time) %>%
mutate(yBoth = cumsum(e %>% rev()) %>% rev(),
y1 = cumsum(e1 %>% rev()) %>% rev(),
y2 = cumsum(e2 %>% rev()) %>% rev(),
Z1 = cumsum(d1) - cumsum(y1*d/yBoth),
varZ1 = y1*y2*d/yBoth^2,
testStat = Z1/sqrt(varZ1))
logRankData$Type =  as.factor(logRankData$Type)
logRankData %>%
ggplot(aes(x = Time, y = testStat, color = Type)) +
geom_line(size = 0.8)
logRankData
times %>%
ungroup() %>%
mutate(d1 = ifelse(Type == 1, d, 0),
d2 = ifelse(Type == 2, d, 0),
c1 = ifelse(Type == 1, c, 0),
c2 = ifelse(Type == 2, c, 0),
e1 = d1 + c1,
e2 = d2 + c2) %>%
group_by(Type)
times %>%
ungroup() %>%
mutate(d1 = ifelse(Type == 1, d, 0),
d2 = ifelse(Type == 2, d, 0),
c1 = ifelse(Type == 1, c, 0),
c2 = ifelse(Type == 2, c, 0),
e1 = d1 + c1,
e2 = d2 + c2) %>%
group_by(Type) %>%
arrange(Time)
logRankData <- times %>%
ungroup() %>%
mutate(d1 = ifelse(Type == 1, d, 0),
d2 = ifelse(Type == 2, d, 0),
c1 = ifelse(Type == 1, c, 0),
c2 = ifelse(Type == 2, c, 0),
e1 = d1 + c1,
e2 = d2 + c2) %>%
group_by(Type) %>%
arrange(Time) %>%
mutate(yBoth = cumsum(e %>% rev()) %>% rev(),
y1 = cumsum(e1 %>% rev()) %>% rev(),
y2 = cumsum(e2 %>% rev()) %>% rev(),
Z1 = cumsum(d1) - cumsum(y1*d/yBoth))
logRankData
logRankData$Z1
times %>%
ungroup() %>%
mutate(d1 = ifelse(Type == 1, d, 0),
d2 = ifelse(Type == 2, d, 0),
c1 = ifelse(Type == 1, c, 0),
c2 = ifelse(Type == 2, c, 0),
e1 = d1 + c1,
e2 = d2 + c2) %>%
mutate(yBoth = cumsum(e %>% rev()) %>% rev(),
y1 = cumsum(e1 %>% rev()) %>% rev(),
y2 = cumsum(e2 %>% rev()) %>% rev(),
Z1 = cumsum(d1) - cumsum(y1*d/yBoth),
varZ1 = y1*y2*d/yBoth^2,
testStat = Z1/sqrt(varZ1))
logRankData <- times %>%
ungroup() %>%
mutate(d1 = ifelse(Type == 1, d, 0),
d2 = ifelse(Type == 2, d, 0),
c1 = ifelse(Type == 1, c, 0),
c2 = ifelse(Type == 2, c, 0),
e1 = d1 + c1,
e2 = d2 + c2) %>%
mutate(yBoth = cumsum(e %>% rev()) %>% rev(),
y1 = cumsum(e1 %>% rev()) %>% rev(),
y2 = cumsum(e2 %>% rev()) %>% rev(),
Z1 = cumsum(d1) - cumsum(y1*d/yBoth),
varZ1 = y1*y2*d/yBoth^2,
testStat = Z1/sqrt(varZ1))
logRankData$Type =  as.factor(logRankData$Type)
logRankData %>%
ggplot(aes(x = Time, y = testStat, color = Type)) +
geom_line(size = 0.8)
logRankData$Type
logRankData %>%
ggplot(aes(x = Time, y = testStat)) +
geom_line(size = 0.8)
logRankData$testStat
logRankData
logRankData$d1
logRankData$d
#This part includes censoring
c <- rexp(n, 1/80)
censored <- data.frame(t0 = t0, c = c) %>%
mutate(cens = as.numeric(t0>c)) %>%
mutate(t0 = ifelse(cens==1, c, t0)) %>%
mutate(t0_bin = round(t0 + 0.05, digits = 1)) %>%
group_by(t0_bin) %>%
summarise(d0 = sum(cens==0),
c0 = sum(cens==1)) %>%
mutate(e0 = d0 + c0) %>%
mutate(y0 = cumsum(e0 %>%  rev()) %>% rev()) %>%
mutate(t0 = as.numeric(t0_bin)) #just for the name, I'm lazy
censored
logRankData <- times %>%
ungroup() %>%
mutate(d1 = ifelse(Type == 1, d, 0),
d2 = ifelse(Type == 2, d, 0),
c1 = ifelse(Type == 1, c, 0),
c2 = ifelse(Type == 2, c, 0),
e1 = d1 + c1,
e2 = d2 + c2) %>%
mutate(yBoth = cumsum(e %>% rev()) %>% rev(),
y1 = cumsum(e1 %>% rev()) %>% rev(),
y2 = cumsum(e2 %>% rev()) %>% rev(),
Z1 = cumsum(d1) - cumsum(y1*d/yBoth),
varZ1 = cumsum(y1*y2*d/yBoth^2),
testStat = Z1/sqrt(varZ1))
logRankData$Type =  as.factor(logRankData$Type)
logRankData %>%
ggplot(aes(x = Time, y = testStat)) +
geom_line(size = 0.8)
logRankData %>%
ggplot(aes(x = Time, y = testStat)) +
geom_line(size = 0.8)
logRankData %>%
ggplot(aes(x = Time, y = testStat)) +
geom_line(size = 0.8) +
geom_line(aes(x = Time, y = -1.96))
logRankData %>%
ggplot(aes(x = Time, y = testStat)) +
geom_line(size = 0.8) +
geom_line(aes(x = Time, y = -1.96), size = 0.8)
logRankData %>%
ggplot(aes(x = Time, y = testStat)) +
geom_line(size = 0.8) +
geom_line(aes(x = Time, y = -1.96), size = 0.8, color = "blue")
logRankData %>%
ggplot(aes(x = Time, y = testStat)) +
geom_line(size = 0.8) +
geom_line(aes(x = Time, y = -1.96), size = 0.8, color = "blue") +
geom_line(aes(x = Time, y = 1.96), size = 0.8, color = "blue")
times %>%
ggplot(aes(x = Time, y = km, color = Type)) +
geom_line(size = 0.8)
library(survival)
suppressPackageStartupMessages(library(survival))
times
times$SurvObj <- with(times, Surv(time, d == 1))
times$SurvObj <- with(times, Surv(as.numeric(time), d == 1))
times$Time
typeof(times$Time)
as.numeric(times$Time)
times$SurvObj <- with(times, Surv(Time, d == 1))
times
tm <- coxph(SurvObj ~ Type, data = times)
tm
summary(tm)
kable(summary(tm))
t1 <- cbind(rweibull(200, shape = 5.5, scale = 22.5), rep(1, 200), runif(200, 20, 60))
t2 <- cbind(rweibull(100, shape = 4.5, scale = 28), rep(2,100), runif(100, 30, 60))
times <- rbind(t1, t2) %>%
data.frame() %>%
setNames(c("Time", "Type", "C")) %>%
mutate(c = ifelse(Time > C, 1, 0),
Time = ifelse(Time > C, C, Time),
d = 1 - c,
e = c + d) %>%
group_by(Type) %>%
arrange(Time) %>%
mutate(y = cumsum(e %>% rev()) %>% rev(),
nelAal = cumsum(d/y),
km = cumprod(1 - d/y))
times$Type = as.factor(times$Type)
times %>%
ggplot(aes(x = Time, y = nelAal, color = Type)) +
geom_line(size = 0.8)
