ggplot(aes(x = Time, y = km, color = Type)) +
geom_line(size = 0.8)
#Cox Regression
times$SurvObj <- with(times, Surv(Time, d == 1))
tm <- coxph(SurvObj ~ as.factor(Type), data = times)
ggsurvplot(survfit(tm, newdata = data.frame("Type" = c(1, 2))),
data = times)
?ggsurvplot
ggsurvplot(survfit(tm, newdata = data.frame("Type" = c(1, 2))),
data = times) +
ylab("Hej")
ggsurvplot(survfit(tm, newdata = data.frame("Type" = c(1, 2))),
data = times)
times %>%
ggplot(aes(x = Time, y = nelAal, color = Type)) +
geom_line(size = 0.8)
# Chunk 1
suppressPackageStartupMessages(library(tidyverse))
suppressPackageStartupMessages(library(knitr))
suppressPackageStartupMessages(library(survival)) #https://stackoverflow.com/questions/35207624/package-pbkrtest-is-not-available-for-r-version-3-2-2
suppressPackageStartupMessages(library(survminer))
# Chunk 2
#Cens Unif(20, 60)
t1 <- cbind(rweibull(200, shape = 5.5, scale = 22.5), rep(1, 200))
t2 <- cbind(rweibull(100, shape = 4.5, scale = 28), rep(2,100))
c <- cbind(runif(300, 20, 60))
times <- rbind(t1, t2) %>%
cbind(c) %>%
data.frame() %>%
setNames(c("Time", "Type", "C")) %>%
mutate(c = ifelse(Time > C, 1, 0),
Time = ifelse(Time > C, C, Time),
d = 1 - c,
e = c + d) %>%
group_by(Type) %>%
arrange(Time) %>%
mutate(y = cumsum(e %>% rev()) %>% rev(),
nelAal = cumsum(d/y),
km = cumprod(1 - d/y))
times$Type = as.factor(times$Type)
#Different Nelson-Aalens
times %>%
ggplot(aes(x = Time, y = nelAal, color = Type)) +
geom_line(size = 0.8)
# Chunk 3
#Logrank. Vill vi ha chi2 eller wald-test?
logRankData <- times %>%
ungroup() %>%
mutate(d1 = ifelse(Type == 1, d, 0),
d2 = ifelse(Type == 2, d, 0),
c1 = ifelse(Type == 1, c, 0),
c2 = ifelse(Type == 2, c, 0),
e1 = d1 + c1,
e2 = d2 + c2) %>%
mutate(yBoth = cumsum(e %>% rev()) %>% rev(),
y1 = cumsum(e1 %>% rev()) %>% rev(),
y2 = cumsum(e2 %>% rev()) %>% rev(),
Z1 = cumsum(d1) - cumsum(y1*d/yBoth),
varZ1 = cumsum(y1*y2*d/yBoth^2),
testStat = Z1/sqrt(varZ1))
logRankData %>%
ggplot(aes(x = Time, y = testStat)) +
geom_line(size = 0.8) +
geom_line(aes(x = Time, y = -1.96), size = 0.8, color = "blue") +
geom_line(aes(x = Time, y = 1.96), size = 0.8, color = "blue")
#Kaplan-Meier
times %>%
ggplot(aes(x = Time, y = km, color = Type)) +
geom_line(size = 0.8)
#Cox Regression
times$SurvObj <- with(times, Surv(Time, d == 1))
tm <- coxph(SurvObj ~ as.factor(Type), data = times)
ggsurvplot(survfit(tm, newdata = data.frame("Type" = c(1, 2))),
data = times)
# Chunk 4
t1 <- cbind(rweibull(200, shape = 5.5, scale = 22.5), rep(1, 200), runif(200, 20, 60))
t2 <- cbind(rweibull(100, shape = 4.5, scale = 28), rep(2,100), runif(100, 30, 60))
times <- rbind(t1, t2) %>%
data.frame() %>%
setNames(c("Time", "Type", "C")) %>%
mutate(c = ifelse(Time > C, 1, 0),
Time = ifelse(Time > C, C, Time),
d = 1 - c,
e = c + d) %>%
group_by(Type) %>%
arrange(Time) %>%
mutate(y = cumsum(e %>% rev()) %>% rev(),
nelAal = cumsum(d/y),
km = cumprod(1 - d/y))
times$Type = as.factor(times$Type)
#Different Nelson-Aalens
times %>%
ggplot(aes(x = Time, y = nelAal, color = Type)) +
geom_line(size = 0.8)
#Logrank. Vill vi ha chi2 eller wald-test?
logRankData <- times %>%
ungroup() %>%
mutate(d1 = ifelse(Type == 1, d, 0),
d2 = ifelse(Type == 2, d, 0),
c1 = ifelse(Type == 1, c, 0),
c2 = ifelse(Type == 2, c, 0),
e1 = d1 + c1,
e2 = d2 + c2) %>%
mutate(yBoth = cumsum(e %>% rev()) %>% rev(),
y1 = cumsum(e1 %>% rev()) %>% rev(),
y2 = cumsum(e2 %>% rev()) %>% rev(),
Z1 = cumsum(d1) - cumsum(y1*d/yBoth),
varZ1 = cumsum(y1*y2*d/yBoth^2),
testStat = Z1/sqrt(varZ1))
logRankData %>%
ggplot(aes(x = Time, y = testStat)) +
geom_line(size = 0.8) +
geom_line(aes(x = Time, y = -1.96), size = 0.8, color = "blue") +
geom_line(aes(x = Time, y = 1.96), size = 0.8, color = "blue")
#Kaplan-Meier
times %>%
ggplot(aes(x = Time, y = km, color = Type)) +
geom_line(size = 0.8)
#Cox Regression
times$SurvObj <- with(times, Surv(Time, d == 1))
tm <- coxph(SurvObj ~ as.factor(Type), data = times)
ggsurvplot(survfit(tm, newdata = data.frame("Type" = c(1, 2))),
data = times)
times %>%
ggplot(aes(x = Time, y = nelAal, color = Type)) +
geom_line(size = 0.8)
times %>%
ggplot(aes(x = Time, y = nelAal, color = Type)) +
geom_line(size = 0.8)
times %>%
ggplot(aes(x = Time, y = nelAal, color = Type)) +
geom_line(size = 0.8) +
ylab("Cumulative Hazard Rate")
times %>%
ggplot(aes(x = Time, y = km, color = Type)) +
geom_line(size = 0.8)
times %>%
ggplot(aes(x = Time, y = nelAal, color = Type)) +
geom_line(size = 0.8) +
ylab("Cumulative Hazard Rate")
logRankData %>%
ggplot(aes(x = Time, y = testStat)) +
geom_line(size = 0.8) +
geom_line(aes(x = Time, y = -1.96), size = 0.8, color = "blue") +
geom_line(aes(x = Time, y = 1.96), size = 0.8, color = "blue")
logRankData %>%
ggplot(aes(x = Time, y = testStat)) +
geom_line(size = 0.8) +
geom_line(aes(x = Time, y = -1.96), size = 0.8, color = "blue") +
geom_line(aes(x = Time, y = 1.96), size = 0.8, color = "blue") +
ylab(expression(Z[1](t)))
times$SurvObj <- with(times, Surv(Time, d == 1))
tm <- coxph(SurvObj ~ as.factor(Type), data = times)
summary(tm)
tm$coefficients
tm$wald.test
times %>%
ggplot(aes(x = Time, y = km, color = Type)) +
geom_line(size = 0.8)
times %>%
ggplot(aes(x = Time, y = km, color = Type)) +
geom_line(size = 0.8)
ggsurvplot(survfit(tm, newdata = data.frame("Type" = c(1, 2))),
data = times)
times %>%
ggplot(aes(x = Time, y = km, color = Type)) +
geom_line(size = 0.8)
times %>%
ggplot(aes(x = Time, y = km, color = Type)) +
geom_line(size = 0.8) +
ylab("Survival Rate")
times %>%
ggplot(aes(x = Time, y = km, color = Type)) +
geom_line(size = 0.8) +
ylab("Kaplan-Meier")
ggsurvplot(survfit(tm, newdata = data.frame("Type" = c(1, 2))),
data = times) +
ylab("Cox PH")
ggsurvplot(survfit(tm, newdata = data.frame("Type" = c(1, 2))),
data = times) +
ylab("Cox PH")
times %>%
ggplot(aes(x = Time, y = km, color = Type)) +
geom_line(size = 0.8) +
ylab("Kaplan-Meier")
ggsurvplot(survfit(tm, newdata = data.frame("Type" = c(1, 2))),
data = times) +
ylab("Cox PH")
times %>%
ggplot(aes(x = Time, y = km, color = Type)) +
geom_line(size = 0.8) +
ylab("Kaplan-Meier")
ggsurvplot(survfit(tm, newdata = data.frame("Type" = c(1, 2))),
data = times) +
ylab("Cox PH")
times %>%
ggplot(aes(x = Time, y = km, color = Type)) +
geom_line(size = 0.8) +
ylab("Kaplan-Meier")
ggsurvplot(survfit(tm, newdata = data.frame("Type" = c(1, 2))),
data = times) +
ylab("Cox PH")
times %>%
ggplot(aes(x = Time, y = km, color = Type)) +
geom_line(size = 0.8) +
ylab("Kaplan-Meier")
ggsurvplot(survfit(tm, newdata = data.frame("Type" = c(1, 2))),
data = times) +
ylab("Cox PH")
ggsurvplot(survfit(tm, newdata = data.frame("Type" = c(1, 2))),
data = times) +
ylab("Cox PH")
times %>%
ggplot(aes(x = Time, y = km, color = Type)) +
geom_line(size = 0.8) +
ylab("Kaplan-Meier")
ggsurvplot(survfit(tm, newdata = data.frame("Type" = c(1, 2))),
data = times) +
ylab("Cox PH")
times %>%
ggplot(aes(x = Time, y = km, color = Type)) +
geom_line(size = 0.8) +
ylab("Kaplan-Meier")
ggsurvplot(survfit(tm, newdata = data.frame("Type" = c(1, 2))),
data = times) +
ylab("Cox PH")
times %>%
ggplot(aes(x = Time, y = km, color = Type)) +
geom_line(size = 0.8) +
ylab("Kaplan-Meier")
ggsurvplot(survfit(tm, newdata = data.frame("Type" = c(1, 2))),
data = times) +
ylab("Cox PH")
ggsurvplot(survfit(tm, newdata = data.frame("Type" = c(1, 2))),
data = times) +
ylab("Cox PH") +
geom_line(aes(x = Time, y = km, color = Type))
ggsurvplot(survfit(tm, newdata = data.frame("Type" = c(1, 2))),
data = times) +
ylab("Cox PH")
times %>%
ggplot(aes(x = Time, y = km, color = Type)) +
geom_line(size = 0.8) +
ylab("Kaplan-Meier")
ggsurvplot(survfit(tm, newdata = data.frame("Type" = c(1, 2))),
data = times) +
ylab("Cox PH")
ggsurvplot(survfit(tm, newdata = data.frame("Type" = c(1, 2))),
data = times) +
ylab("Cox")
times %>%
ggplot(aes(x = Time, y = km, color = Type)) +
geom_line(size = 0.8) +
ylab("Kaplan-Meier Estimator")
times %>%
ggplot(aes(x = Time, y = km, color = Type)) +
geom_line(size = 0.8) +
ylab("Kaplan-Meier Estimate")
ggsurvplot(survfit(tm, newdata = data.frame("Type" = c(1, 2))),
data = times) +
ylab("Cox Estimate")
times %>%
ggplot(aes(x = Time, y = km, color = Type)) +
geom_line(size = 0.8) +
ylab("Kaplan-Meier Estimate")
ggsurvplot(survfit(tm, newdata = data.frame("Type" = c(1, 2))),
data = times) +
ylab("Cox Estimate")
times %>%
ggplot(aes(x = Time, y = km, color = Type)) +
geom_line(size = 0.8) +
ylab("Kaplan-Meier Estimate")
ggsurvplot(survfit(tm, newdata = data.frame("Type" = c(1, 2))),
data = times) +
ylab("Cox Estimate")
t1 <- cbind(rweibull(200, shape = 5.5, scale = 22.5), rep(1, 200), runif(200, 20, 60))
t2 <- cbind(rweibull(100, shape = 4.5, scale = 28), rep(2,100), runif(100, 30, 60))
times <- rbind(t1, t2) %>%
data.frame() %>%
setNames(c("Time", "Type", "C")) %>%
mutate(c = ifelse(Time > C, 1, 0),
Time = ifelse(Time > C, C, Time),
d = 1 - c,
e = c + d) %>%
group_by(Type) %>%
arrange(Time) %>%
mutate(y = cumsum(e %>% rev()) %>% rev(),
nelAal = cumsum(d/y),
km = cumprod(1 - d/y))
times$Type = as.factor(times$Type)
times %>%
ggplot(aes(x = Time, y = nelAal, color = Type)) +
geom_line(size = 0.8)
logRankData <- times %>%
ungroup() %>%
mutate(d1 = ifelse(Type == 1, d, 0),
d2 = ifelse(Type == 2, d, 0),
c1 = ifelse(Type == 1, c, 0),
c2 = ifelse(Type == 2, c, 0),
e1 = d1 + c1,
e2 = d2 + c2) %>%
mutate(yBoth = cumsum(e %>% rev()) %>% rev(),
y1 = cumsum(e1 %>% rev()) %>% rev(),
y2 = cumsum(e2 %>% rev()) %>% rev(),
Z1 = cumsum(d1) - cumsum(y1*d/yBoth),
varZ1 = cumsum(y1*y2*d/yBoth^2),
testStat = Z1/sqrt(varZ1))
logRankData %>%
ggplot(aes(x = Time, y = testStat)) +
geom_line(size = 0.8) +
geom_line(aes(x = Time, y = -1.96), size = 0.8, color = "blue") +
geom_line(aes(x = Time, y = 1.96), size = 0.8, color = "blue")
times %>%
ggplot(aes(x = Time, y = nelAal, color = Type)) +
geom_line(size = 0.8) +
ylab("Cumulative Hazard Rate")
logRankData <- times %>%
ungroup() %>%
mutate(d1 = ifelse(Type == 1, d, 0),
d2 = ifelse(Type == 2, d, 0),
c1 = ifelse(Type == 1, c, 0),
c2 = ifelse(Type == 2, c, 0),
e1 = d1 + c1,
e2 = d2 + c2) %>%
mutate(yBoth = cumsum(e %>% rev()) %>% rev(),
y1 = cumsum(e1 %>% rev()) %>% rev(),
y2 = cumsum(e2 %>% rev()) %>% rev(),
Z1 = cumsum(d1) - cumsum(y1*d/yBoth),
varZ1 = cumsum(y1*y2*d/yBoth^2),
testStat = Z1/sqrt(varZ1))
logRankData %>%
ggplot(aes(x = Time, y = testStat)) +
geom_line(size = 0.8) +
geom_line(aes(x = Time, y = -1.96), size = 0.8, color = "blue") +
geom_line(aes(x = Time, y = 1.96), size = 0.8, color = "blue")
times %>%
ggplot(aes(x = Time, y = km, color = Type)) +
geom_line(size = 0.8)
times$SurvObj <- with(times, Surv(Time, d == 1))
tm <- coxph(SurvObj ~ as.factor(Type), data = times)
ggsurvplot(survfit(tm, newdata = data.frame("Type" = c(1, 2))),
data = times)
times %>%
ggplot(aes(x = Time, y = km, color = Type)) +
geom_line(size = 0.8)
ggsurvplot(survfit(tm, newdata = data.frame("Type" = c(1, 2))),
data = times)
times %>%
ggplot(aes(x = Time, y = km, color = Type)) +
geom_line(size = 0.8)
logRankData %>%
ggplot(aes(x = Time, y = testStat)) +
geom_line(size = 0.8) +
geom_line(aes(x = Time, y = -1.96), size = 0.8, color = "blue") +
geom_line(aes(x = Time, y = 1.96), size = 0.8, color = "blue")
times %>%
ggplot(aes(x = Time, y = nelAal, color = Type)) +
geom_line(size = 0.8) +
ylab("Cumulative Hazard Rate")
times %>%
ggplot(aes(x = Time, y = km, color = Type)) +
geom_line(size = 0.8) +
ylab("Kaplan-Meier Estimate")
times$SurvObj <- with(times, Surv(Time, d == 1))
tm <- coxph(SurvObj ~ as.factor(Type), data = times)
ggsurvplot(survfit(tm, newdata = data.frame("Type" = c(1, 2))),
data = times) +
ylab("Cox Estimate")
t1 <- cbind(rweibull(200, shape = 5.5, scale = 22.5), rep(1, 200))
t2 <- cbind(rweibull(100, shape = 4.5, scale = 28), rep(2,100))
c <- cbind(runif(300, 20, 60))
tm$coefficients
tm$assign
# Chunk 1
suppressPackageStartupMessages(library(tidyverse))
suppressPackageStartupMessages(library(knitr))
suppressPackageStartupMessages(library(survival)) #https://stackoverflow.com/questions/35207624/package-pbkrtest-is-not-available-for-r-version-3-2-2
suppressPackageStartupMessages(library(survminer))
# Chunk 2
#Cens Unif(20, 60)
t1 <- cbind(rweibull(200, shape = 5.5, scale = 22.5), rep(1, 200))
t2 <- cbind(rweibull(100, shape = 4.5, scale = 28), rep(2,100))
c <- cbind(runif(300, 20, 60))
times <- rbind(t1, t2) %>%
cbind(c) %>%
data.frame() %>%
setNames(c("Time", "Type", "C")) %>%
mutate(c = ifelse(Time > C, 1, 0),
Time = ifelse(Time > C, C, Time),
d = 1 - c,
e = c + d) %>%
group_by(Type) %>%
arrange(Time) %>%
mutate(y = cumsum(e %>% rev()) %>% rev(),
nelAal = cumsum(d/y),
km = cumprod(1 - d/y))
times$Type = as.factor(times$Type)
#Different Nelson-Aalens
times %>%
ggplot(aes(x = Time, y = nelAal, color = Type)) +
geom_line(size = 0.8) +
ylab("Cumulative Hazard Rate")
# Chunk 3
#Logrank. Vill vi ha chi2 eller wald-test?
logRankData <- times %>%
ungroup() %>%
mutate(d1 = ifelse(Type == 1, d, 0),
d2 = ifelse(Type == 2, d, 0),
c1 = ifelse(Type == 1, c, 0),
c2 = ifelse(Type == 2, c, 0),
e1 = d1 + c1,
e2 = d2 + c2) %>%
mutate(yBoth = cumsum(e %>% rev()) %>% rev(),
y1 = cumsum(e1 %>% rev()) %>% rev(),
y2 = cumsum(e2 %>% rev()) %>% rev(),
Z1 = cumsum(d1) - cumsum(y1*d/yBoth),
varZ1 = cumsum(y1*y2*d/yBoth^2),
testStat = Z1/sqrt(varZ1))
logRankData %>%
ggplot(aes(x = Time, y = testStat)) +
geom_line(size = 0.8) +
geom_line(aes(x = Time, y = -1.96), size = 0.8, color = "blue") +
geom_line(aes(x = Time, y = 1.96), size = 0.8, color = "blue") +
ylab(expression(Z[1](t)))
# Chunk 4
#Cox Regression
times$SurvObj <- with(times, Surv(Time, d == 1))
tm <- coxph(SurvObj ~ as.factor(Type), data = times)
summary(tm)
# Chunk 5
#Kaplan-Meier
times %>%
ggplot(aes(x = Time, y = km, color = Type)) +
geom_line(size = 0.8) +
ylab("Kaplan-Meier Estimate")
ggsurvplot(survfit(tm, newdata = data.frame("Type" = c(1, 2))),
data = times) +
ylab("Cox Estimate")
# Chunk 6
t1 <- cbind(rweibull(200, shape = 5.5, scale = 22.5), rep(1, 200), runif(200, 20, 60))
t2 <- cbind(rweibull(100, shape = 4.5, scale = 28), rep(2,100), runif(100, 30, 60))
times <- rbind(t1, t2) %>%
data.frame() %>%
setNames(c("Time", "Type", "C")) %>%
mutate(c = ifelse(Time > C, 1, 0),
Time = ifelse(Time > C, C, Time),
d = 1 - c,
e = c + d) %>%
group_by(Type) %>%
arrange(Time) %>%
mutate(y = cumsum(e %>% rev()) %>% rev(),
nelAal = cumsum(d/y),
km = cumprod(1 - d/y))
times$Type = as.factor(times$Type)
#Different Nelson-Aalens
times %>%
ggplot(aes(x = Time, y = nelAal, color = Type)) +
geom_line(size = 0.8) +
ylab("Cumulative Hazard Rate")
#Logrank. Vill vi ha chi2 eller wald-test?
logRankData <- times %>%
ungroup() %>%
mutate(d1 = ifelse(Type == 1, d, 0),
d2 = ifelse(Type == 2, d, 0),
c1 = ifelse(Type == 1, c, 0),
c2 = ifelse(Type == 2, c, 0),
e1 = d1 + c1,
e2 = d2 + c2) %>%
mutate(yBoth = cumsum(e %>% rev()) %>% rev(),
y1 = cumsum(e1 %>% rev()) %>% rev(),
y2 = cumsum(e2 %>% rev()) %>% rev(),
Z1 = cumsum(d1) - cumsum(y1*d/yBoth),
varZ1 = cumsum(y1*y2*d/yBoth^2),
testStat = Z1/sqrt(varZ1))
logRankData %>%
ggplot(aes(x = Time, y = testStat)) +
geom_line(size = 0.8) +
geom_line(aes(x = Time, y = -1.96), size = 0.8, color = "blue") +
geom_line(aes(x = Time, y = 1.96), size = 0.8, color = "blue")
#Kaplan-Meier
times %>%
ggplot(aes(x = Time, y = km, color = Type)) +
geom_line(size = 0.8) +
ylab("Kaplan-Meier Estimate")
#Cox Regression
times$SurvObj <- with(times, Surv(Time, d == 1))
tm <- coxph(SurvObj ~ as.factor(Type), data = times)
ggsurvplot(survfit(tm, newdata = data.frame("Type" = c(1, 2))),
data = times) +
ylab("Cox Estimate")
summary(tm)
summary(tm)$coef
summary(tm)$coef$coef
summary(tm)$estimate
summary(tm)$coef[0]
summary(tm)$coef[1]
exp(summary(tm)$coef[1])
summary(tm)
install.package(survminer)
install.packages(survminer)
install.packages("survminer")
install.packages("survminer")
install.packages("survminer")
install.packages("survminer")
install.packages("survminer")
if(!require(devtools)) install.packages("devtools")
devtools::install_github("kassambara/survminer")
install.packages("survminer")
install.packages("sruvminer")
install.packages("survminer")
install.packages("survminer")
library(survminer)
